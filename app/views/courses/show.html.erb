<% content_for :title, @course.name %>

<div class="min-h-screen bg-gray-50 dark:bg-gray-900">
  <div class="container-xl py-8">
    <%= link_to courses_path, class: "btn-ghost btn-sm mb-6 inline-flex" do %>
      <%= lucide_icon "arrow-left", class: "w-4 h-4 mr-2" %>
      返回课程列表
    <% end %>

    <!-- Course Content -->
    <% if @course.chapters.any? %>
      <div class="space-y-4">
        <% @course.chapters.each_with_index do |chapter, index| %>
          <div class="card">
            <div class="card-header bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
              <div class="flex items-center justify-between">
                <h2 class="text-xl font-bold text-gray-900 dark:text-gray-50">
                  <%= "第#{index + 1}章" %> <%= chapter.name %>
                </h2>
                <span class="text-sm text-gray-600 dark:text-gray-400">
                  <%= chapter.lessons.count %> 个课时
                </span>
              </div>
            </div>
            <div class="card-body p-0">
              <div class="divide-y divide-gray-200 dark:divide-gray-700">
                <% chapter.lessons.each_with_index do |lesson, lesson_index| %>
                  <div class="p-4 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-4 flex-1">
                        <div class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-sm font-medium text-gray-600 dark:text-gray-400">
                          <%= lesson_index + 1 %>
                        </div>
                        
                        <div class="flex-1">
                          <%= link_to lesson.name, lesson_path(lesson), class: "text-gray-900 dark:text-gray-50 hover:text-primary font-medium" %>
                          <% if lesson.video_url.present? %>
                            <span class="ml-2 inline-flex items-center gap-1 text-xs text-gray-500">
                              <%= lucide_icon "video", class: "w-3 h-3" %>
                              视频
                            </span>
                          <% end %>
                        </div>
                      </div>
                      
                      <div class="flex items-center gap-3">
                        <% if lesson.free? %>
                          <span class="badge badge-success">试看</span>
                        <% elsif current_user && current_user.has_access_to?(@course) %>
                          <% progress = current_user.progresses.find_by(lesson: lesson) %>
                          <% if progress&.status == 'completed' %>
                            <%= lucide_icon "check-circle", class: "w-5 h-5 text-green-500" %>
                          <% end %>
                        <% else %>
                          <%= lucide_icon "lock", class: "w-5 h-5 text-gray-400" %>
                        <% end %>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="card">
        <div class="card-body text-center py-12">
          <%= lucide_icon "book-open", class: "w-16 h-16 mx-auto mb-4 text-gray-400" %>
          <p class="text-gray-600 dark:text-gray-400">课程内容正在准备中...</p>
        </div>
      </div>
    <% end %>
  </div>
</div>
